---
title: "GAE10: PCA & NMDS"
author: "Jaslyn"
format: 
  html:
    theme: custom.scss
    embed-resources: true
    code-tools: true

csl: ecology.csl
editor: visual
bibliography: references.bib
---

```{r }
#| label: setup
#| echo: false
#| message: false # to suppress "info messages"

knitr::opts_chunk$set(
  echo = FALSE
  )

library(latex2exp)
library(patchwork)
library(kableExtra)
library(tidyverse)
library(vegan) 
library(ggrepel) 
library(FactoMineR) 
library(factoextra) 
library(broom)

options(scipen = 10)

options(knitr.kable.NA = "")




```

## Scenario 1: Ecology, Behavior, and Coraciiformes Color

Coraciiform species (@fig-Kingfishers) have diverse plumage coloration including pigmentary and structural colors, live in a range of different environments, show variable levels of territoriality, variability in the presence or absence of cooperative breeding (but with near uniform social monogamy), and different types of hunting strategy. @babarovicEffectsEcologyBehavior2023 measured plumage coloration from digital images of museum specimens and quantified several proxies for factors that could play a key role in the evolution of coloration including sex, body size, hunting strategy, habitat light environment, territoriality, and social mating system. They were interested in exploring how different possible biotic and abiotic factors may have affected the evolution of Coraciiform coloration.

### Methods:

The researchers used study skins of 117 species of Coraciiformes (families Meropidae, Brachypteraciidae, Coraciidae, Todidae, Momotidae, Alcedinidae) from the bird collections of the Natural History Museum at Tring, UK. Calibrated digital images of study skins were taken using methods described in @cooneySexualSelectionPredicts2019 and were used to quantify both chromatic (hue and saturation) and achromatic (brightness) components of color for each of several body regions (patches). The selected body regions were: crown, nape, mantle, rump, tail, wing coverts, wing primaries and secondaries, throat, breast, belly, and tail underside. They then used mapping functions to convert red-green-blue values for each patch on each specimen into values appropriate for the visual abilities of this order. Then they calculated average patch values (separately for each sex) as a species-level measure for each body patch. They then used principle components analysis to reduce the dimensionality of the color data across body patches and species and found that the first principle component accounted for \>80% of the variation in color [@babarovicEffectsEcologyBehavior2023]. @babarovicEffectsEcologyBehavior2023 then collated information on: body size; light-level associated habitat preference; hunting strategies; territoriality; and cooperative breeding from available literature.

```{r}
#| label: fig-Kingfishers
#| fig-cap: "A collage showing some of the plumage color diversity in the Coraciiformes. (a) Forest kingfisher (*Todiramphus macleayii*), Alcedinidae; (b) Common kingfisher (*Alcedo atthis*), Alcedinidae; (c) White-fronted bee-eater (*Merops bullockoides*), Meropidae; (d) Red-bearded bee-eater (*Nyctyornis amictus*), Meropidae; (e) European roller (*Coracias garrulus*), Coraciidae; (f) Lilac-breasted roller (*Coracias caudatus*), Coraciidae; (g) Broad-billed today (*Todus subulatus*), Todidae; (h) Narrow-billed today (*Todus angustirostris*), Todidae. All photos © Daniel J. Field, University of Cambridge."
#| out-width: "80%"


knitr::include_graphics("Kingfishers.png")

```

#### Statistical Methods:

```{r}
#| label: Scenario1DataImport

# I have provided the PCA1 scores for the patches (columns 2-12) as an index of
# the complex color data for each species (rows) as well as the body size (a
# quantitative supplementary variable, column 13) and ecological behavioral
# classifications (qualitative supplemental variables, columns 14-17) in
# colors.csv. Please explore any grouping and/or patterning among the species
# and their ecological/behavioral traits.

scen1data <- read_csv("colors.csv", show_col_types = FALSE)

```

```{r}
#| label: fig-scen1biplot
#| fig-cap: "PCA of hunting strategies"
#| fig-asp: 0.8

scen1PCA <- PCA(
  scen1data,
  quanti.sup = 13,
  quali.sup = c(1, 14:17),
  graph = FALSE
)

Indfig <- fviz_pca_ind(
  scen1PCA,
  repel = TRUE, 
  label = "none",
  habillage = 
    "Hunting_strategy"
    )


Varfig <- fviz_pca_var(
  scen1PCA,
  repel = TRUE, 
  label = "var"
)

Varfig +
  Indfig +
  plot_layout(ncol = 1)
```

A package was used for the PCA above [@FactoMineR]. The function fviz from a pacakge was used above [@factoextra] . A package was used to allow location of labels to not overlap [@ggrepel] .

In the PCA- Biplot Hunting_Strategy, Light_environment, Parental_care and territoriality overlapped whenever addEllipses was true (this showed no significant difference between these) with all labels included. Went back and took out addEllipses and switched the labels to only be variables. Then did a Bi-Plot of individuals and changed the labels to be none\@fig-scen1biplot

Vector interp: Strong correlation was seen with tail, rump, etc. in 1st principle component, tends to be how blue the bird is (primary, secondary, tail, etc). Belly, breast etc. were more strongly correlated with 2nd principle component, how much red/green you get. @fig-scen1biplot

Centroid in these plots are big compared to the other symbols. The BiPlot may suggests some things going on that may be affecting the evolution of color in these birds.

Hunting_strategy showed the greatest seperation and showed that these birds might have different colors based on there hunting strategy. @fig-scen1biplot The water divers tend to be more blue, the ground-dwellers have less markings on undersides that are less obvious.

In light_environment there appears to be a cluster away from the bright blue for the forest birds, less bright blue, more red/green. Parental_care shows whether or not the entire family takes care of young. Shows there may be more color in underside of those whose entire family takes care of young. Territoriality shows a lot of overlap, looks less like territoriality had any effect, so we took these out and just focused on hunting_strategy.

No huge differences, however, one could come up with hypotheses such as "that being a diving bird you'd want to be more blue".

### References:

Babarović, F., C. R. Cooney, Z. K. Varley, L. O. Nouri, N. J. Nadeau, and G. H. Thomas. 2023. [The effects of ecology and behavior on the evolution of coloration in Coraciiformes](https://doi.org/10.1093/beheco/arad008). Behavioral Ecology 34:387–398.

Cooney, C. R., Z. K. Varley, L. O. Nouri, C. J. A. Moody, M. D. Jardine, and G. H. Thomas. 2019. [Sexual selection predicts the rate and direction of colour divergence in a large avian radiation](https://doi.org/10.1038/s41467-019-09859-7). Nature Communications 10:1773.

Kassambara, A., and F. Mundt. 2020. [Factoextra: Extract and visualize the results of multivariate data analyses](https://cran.r-project.org/package=factoextra).

Lê, S., J. Josse, and F. Husson. 2008. [FactoMineR: A package for multivariate analysis](https://doi.org/10.18637/jss.v025.i01). Journal of Statistical Software 25:1–18.

Sabo, A. E., K. L. Frerker, D. M. Waller, and E. L. Kruger. 2017. [Deer-mediated changes in environment compound the direct impacts of herbivory on understorey plant communities](https://doi.org/10.1111/1365-2745.12748). Journal of Ecology 105:1386–1398.

Slowikowski, K. 2024. [Ggrepel: Automatically position non-overlapping text labels with ’ggplot2’](https://cran.r-project.org/package=ggrepel).

------------------------------------------------------------------------

## Scenario 2: Deer and Forest Plant Communities

White-tailed deer (*Odocoileus virginianus*) are often considered to be keystone species in forest communities. @sabo2017 conducted surveys of the vegetation and environmental conditions of deer exclusion plots and adjacent plots outside the exclusion areas as part of a larger study to examine the indirect effects of their presence on the plant assemblages.

### Methods:

In Summer 2011, the researchers visited 17 deer exclosures in upland forests of northern Wisconsin and Michigan's Upper Peninsula (UP) that were constructed for various previous studies between 1991 and 2002. In each stand, they sampled vegetation and measured key environmental variables inside the fences and in paired ‘deer-access’ plots outside the fences. The latter were in close proximity to the exclosures (always within 100 m), and were placed in locations with similar management histories and overstory structure and composition. Within each exclosure and control area, multiple quadrats were sampled and they recorded the incidence of all herbaceous, shrub, and tree seedling species.

#### Statistical Methods:

```{r}
#| label: Scenario2DataImport

# I have provided data representing the proportion of quadrats each species
# (columns) was found in as a an index of abundance within each deer exclosure
# (rows) in Sabo_etal_data.csv.

# Use NMDS to explore the differences in plant community inside and outside the
# deer exclosures, then test for differences in the plant communities between
# the deer exclosures and the adjacent forests.

df2 <- read_csv("Sabo_etal_data.csv", show_col_types = FALSE)
```

```{r}
#| label: scen2nMDS
#| results: hide

scen2mds <- metaMDS(
  df2[,-c(1:2)],
  k=4
)


scen2mds$stress
```

A package was used [@vegan] to run MDS and check stress levels. Plant communities overlapped almost completely in the nMDS plot scores, the two types were the control and the exclosure. These nMDS plot scores were essentially produced by non-metric multidimensional scaling of square-root transformed counts

```{r}
#| label: tbl-scen2PERMANOVA
#| tbl-cap: "PERMANOVA to test for a difference in plant assemblages between deer exclusion areas and adjacent areas."

scen2PERMANOVA <- adonis2(
  df2[,-c(1,2)] ~ Treatment,
  data = df2,
  by = "margin",
  permutations = 10001
)

kbl(
  scen2PERMANOVA,
  format = "markdown",
  digits = c(0,3,3,3,3),
  col.names = c(
    "df",
    "SS",
    "$R^2$",
    "F",
    "P"
  )
)
```

Failed to reject the null hypothesis that the communities are the same.

### References:
